# Грамматика языка MiniLang
## Пользовательская грамматика
| Non-terminal          | Продукция                                                                         |
|-----------------------|-----------------------------------------------------------------------------------|
| **Программа**         | `{Оператор}`                                                                      |
| **Оператор**          | `Объявление`<br>`⎮ Присваивание`<br>`⎮ УсловныйОператор`<br>`⎮ Цикл`<br>`⎮ Вывод` |
| **Объявление**        | `"int" Идентификатор ";"`                                                         |
| **Присваивание**      | `Идентификатор "=" Выражение ";"`                                                 |
| **УсловныйОператор**  | `"if" "(" Условие ")" "{" Программа "}" ["else" "{" Программа "}"]`               |
| **Цикл**              | `"while" "(" Условие ")" "{" Программа "}"`                                       |
| **Вывод**             | `"print" Выражение ";"`                                                           |
| **Условие**           | `Выражение ОператорСравнения Выражение`                                           |
| **ОператорСравнения** | `"==" ⎮ "!=" ⎮ "<" ⎮ ">"`                                                         |
| **Выражение**         | `Терм {("+" ⎮ "-") Терм}`                                                         |
| **Терм**              | `Фактор {("*" ⎮ "/") Фактор}`                                                     |
| **Фактор**            | `Идентификатор`<br>`⎮ ЦелочисленныйЛитерал`<br>`⎮ "(" Выражение ")"`              |
## Условные обозначения

- `"..."` — терминал (ключевое слово, оператор или символ)
- `{ }` — повторение 0 или более раз
- `[ ]` — необязательная часть
- `⎮` — разделитель альтернатив (или)

## Формальная грамматика для парсера с множествами выбора

| Non-terminal          | Продукция                                                                                                                                                                                                               | Множества выбора (FIRST)                                                                                 |
|-----------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------|
| **Программа**         | `Оператор Программа`<br>`⎮ ε`                                                                                                                                                                                           |                                                                                                          |
| **Оператор**          | `"int" Идентификатор ";"`<br>`⎮ Идентификатор "=" Выражение ";"`<br>`⎮ "if" "(" Условие ")" "{" Программа "}" ["else" "{" Программа "}"]`<br>`⎮ "while" "(" Условие ")" "{" Программа "}"`<br>`⎮ "print" Выражение ";"` | `FIRST = {int}`<br>`FIRST = {Идентификатор}`<br>`FIRST = {if}`<br>`FIRST = {while}`<br>`FIRST = {print}` |
| **Условие**           | `Выражение ОператорСравнения Выражение`                                                                                                                                                                                 |                                                                                                          |
| **ОператорСравнения** | `"==" ⎮ "!=" ⎮ "<" ⎮ ">"`                                                                                                                                                                                               |                                                                                                          |
| **Выражение**         | `Терм Выражение'`                                                                                                                                                                                                       |                                                                                                          |
| **Выражение'**        | `"+" Терм Выражение'`<br>`⎮ "-" Терм Выражение'`<br>`⎮ ε`                                                                                                                                                               |                                                                                                          |
| **Терм**              | `Фактор Терм'`                                                                                                                                                                                                          |                                                                                                          |
| **Терм'**             | `"*" Фактор Терм'`<br>`⎮ "/" Фактор Терм'`<br>`⎮ ε`                                                                                                                                                                     |                                                                                                          |
| **Фактор**            | `Идентификатор`<br>`⎮ ЦелочисленныйЛитерал`<br>`⎮ "(" Выражение ")"`                                                                                                                                                    |                                                                                                          |

## Пояснения
- `ε` — пустая строка (эпсилон)
- `FIRST` — множество первых терминалов для альтернатив
- Правила представлены в форме, устраняющей левую рекурсию

## Множества FIRST и FOLLOW для Non-terminal
| Non-terminal      | FIRST                          | FOLLOW                            |
|-------------------|--------------------------------|-----------------------------------|
| Программа         | {int, id, if, while, print, ε} | {$}                               |
| Оператор          | {int, id, if, while, print}    | {int, id, if, while, print, }, $} |
| Условие           | {id, number, (}                | {)}                               |
| ОператорСравнения | {==, !=, <, >}                 | {id, number, (}                   |
| Выражение         | {id, number, (}                | {;, ), ==, !=, <, >, +, -, *, /}  |
| Выражение'        | {+, -, ε}                      | {;, ), ==, !=, <, >}              |
| Терм              | {id, number, (}                | {+, -, ;, ), ==, !=, <, >}        |
| Терм'             | {*, /, ε}                      | {+, -, ;, ), ==, !=, <, >}        |
| Фактор            | {id, number, (}                | {+, -, *, /, ;, ), ==, !=, <, >}  |

## Методы реализации
### Лексический анализатор
Метод: Комбинация расширяемого конечного автомата и бинарного поиска
- Расширяемый конечный автомат для распознавания числовых литералов, идентификаторов и операторов 
- Упорядоченный список (бинарный поиск) для ключевых слов 
- Поддержка однострочных комментариев // 
- Сохранение позиции токенов в исходном коде

### Синтаксический анализатор
Метод: Рекурсивный спуск
- LL(1)-парсер с предпросмотром одного токена 
- Рекурсивные методы для каждого нетерминала грамматики
- Построение абстрактного синтаксического дерева (AST)
- Детальные сообщения об ошибках с указанием строки и позиции

### Генератор промежуточного кода
Метод: Трёхадресный код (3-address code)
- Использование временных переменных для промежуточных результатов 
- Метки для управления потоком выполнения 
- Поддержка всех конструкций языка через базовые операции

### Оптимизатор
Метод: Базовые локальные оптимизации
- Свёртка констант (constant folding)
- Удаление неиспользуемых меток (dead label elimination)

### Интерпретатор
Метод: Виртуальная машина с стеком памяти
- Выполнение трёхадресного кода 
- Динамическое выделение памяти для переменных 
- Поддержка арифметических и логических операций 
- Управление потоком через метки и условные переходы

## Пример выполнения программы

Код на вход:
```
int sum;
int i;
sum = 0;
i = 1;

while (i < 11) {
sum = sum + i;
i = i + 1;
}

print sum;
```

## Таблица токенов
| Номер Строки | Позиция | Имя Лексемы | Класс Лексемы | Значение |
|:------------:|:-------:|:-----------:|:-------------:|:--------:|
|      1       |    0    |     INT     |    KEYWORD    | `int   ` |
|      1       |    4    | IDENTIFIER  |  IDENTIFIER   | `sum   ` |
|      1       |    7    |  SEMICOLON  |  PUNCTUATION  | `;     ` |
|      2       |    0    |     INT     |    KEYWORD    | `int   ` |
|      2       |    4    | IDENTIFIER  |  IDENTIFIER   | `i     ` |
|      2       |    5    |  SEMICOLON  |  PUNCTUATION  | `;     ` |
|      3       |    0    | IDENTIFIER  |  IDENTIFIER   | `sum   ` |
|      3       |    4    |   ASSIGN    |   OPERATOR    | `=     ` |
|      3       |    6    | INT_LITERAL |    LITERAL    | `0     ` |
|      3       |    7    |  SEMICOLON  |  PUNCTUATION  | `;     ` |
|      4       |    0    | IDENTIFIER  |  IDENTIFIER   | `i     ` |
|      4       |    2    |   ASSIGN    |   OPERATOR    | `=     ` |
|      4       |    4    | INT_LITERAL |    LITERAL    | `1     ` |
|      4       |    5    |  SEMICOLON  |  PUNCTUATION  | `;     ` |
|      6       |    0    |    WHILE    |    KEYWORD    | `while ` |
|      6       |    6    |   LPAREN    |  PUNCTUATION  | `(     ` |
|      6       |    7    | IDENTIFIER  |  IDENTIFIER   | `i     ` |
|      6       |    9    |    LESS     |   OPERATOR    | `<     ` |
|      6       |   11    | INT_LITERAL |    LITERAL    | `11    ` |
|      6       |   13    |   RPAREN    |  PUNCTUATION  | `)     ` |
|      6       |   15    |   LBRACE    |  PUNCTUATION  | `{     ` |
|      7       |    4    | IDENTIFIER  |  IDENTIFIER   | `sum   ` |
|      7       |    8    |   ASSIGN    |   OPERATOR    | `=     ` |
|      7       |   10    | IDENTIFIER  |  IDENTIFIER   | `sum   ` |
|      7       |   14    |    PLUS     |   OPERATOR    | `+     ` |
|      7       |   16    | IDENTIFIER  |  IDENTIFIER   | `i     ` |
|      7       |   17    |  SEMICOLON  |  PUNCTUATION  | `;     ` |
|      8       |    4    | IDENTIFIER  |  IDENTIFIER   | `i     ` |
|      8       |    6    |   ASSIGN    |   OPERATOR    | `=     ` |
|      8       |    8    | IDENTIFIER  |  IDENTIFIER   | `i     ` |
|      8       |   10    |    PLUS     |   OPERATOR    | `+     ` |
|      8       |   12    | INT_LITERAL |    LITERAL    | `1     ` |
|      8       |   13    |  SEMICOLON  |  PUNCTUATION  | `;     ` |
|      9       |    0    |   RBRACE    |  PUNCTUATION  | `}     ` |
|      11      |    0    |    PRINT    |    KEYWORD    | `print ` |
|      11      |    6    | IDENTIFIER  |  IDENTIFIER   | `sum   ` |
|      11      |    9    |  SEMICOLON  |  PUNCTUATION  | `;     ` |
|      11      |   10    |     EOF     |  END_OF_FILE  | `EOF   ` |

## Построенное AST-дерево
```
PROGRAM_BLOCK (6 statements)
|-- VAR_DECL (INT sum)
|-- VAR_DECL (INT i)
|-- ASSIGN_STMT (ID: sum)
|   `-- Expression:
|       `-- INT_LITERAL (0)
|-- ASSIGN_STMT (ID: i)
|   `-- Expression:
|       `-- INT_LITERAL (1)
|-- WHILE_STMT
|   |-- Condition:
|   |   `-- BINARY_OP (LESS)
|   |       |-- Left:
|   |       |   `-- IDENTIFIER (i)
|   |       `-- Right:
|   |           `-- INT_LITERAL (11)
|   `-- BODY_BLOCK:
PROGRAM_BLOCK (2 statements)
|       |-- ASSIGN_STMT (ID: sum)
|       |   `-- Expression:
|       |       `-- BINARY_OP (PLUS)
|       |           |-- Left:
|       |           |   `-- IDENTIFIER (sum)
|       |           `-- Right:
|       |               `-- IDENTIFIER (i)
|       `-- ASSIGN_STMT (ID: i)
|           `-- Expression:
|               `-- BINARY_OP (PLUS)
|                   |-- Left:
|                   |   `-- IDENTIFIER (i)
|                   `-- Right:
|                       `-- INT_LITERAL (1)
`-- PRINT_STMT
    `-- Expression:
        `-- IDENTIFIER (sum)
```
## Итоговый сгенерированный IR код
```asm
000: sum = 0
001: i = 1
L1: LABEL
003: T1 = i CMP_LT 11
004: JMP_IF_ZERO T1, L2
005: T2 = sum ADD i
006: sum = T2
007: T3 = i ADD 1
008: i = T3
009: JMP L1
L2: LABEL
011: PRINT sum
```